{"version":3,"sources":["Promise.js"],"names":[],"mappings":"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","file":"Promise.js","sourcesContent":["/**\r\n * Created by anchen on 2016/2/22.\r\n */\r\nexport class Promise {\r\n\r\n\r\n    constructor() {\r\n        this.State = {\r\n            PENDING: 0,\r\n            FULFILLED: 1,\r\n            REJECTED: 2\r\n        };\r\n        this.state = this.State.PENDING\r\n    }\r\n\r\n    changeState(state, value) {\r\n        // catch changing to same state (perhaps trying to change the value)\r\n        if (this.state == state) {\r\n            throw new Error(\"can't transition to same state: \" + state);\r\n        }\r\n\r\n        // trying to change out of fulfilled or rejected\r\n        if (this.state == this.State.FULFILLED ||\r\n            this.state == this.State.REJECTED) {\r\n            throw new Error(\"can't transition from current state: \" + state);\r\n        }\r\n\r\n        // if second argument isn't given at all (passing undefined allowed)\r\n        if (state == this.State.FULFILLED &&\r\n            arguments.length < 2) {\r\n            throw new Error(\"transition to fulfilled must have a non null value\");\r\n        }\r\n\r\n        // if a null reason is passed in\r\n        if (state == this.State.REJECTED &&\r\n            value == null) {\r\n            throw new Error(\"transition to rejected must have a non null reason\");\r\n        }\r\n\r\n        //change state\r\n        this.state = state;\r\n        this.value = value;\r\n        return this.state;\r\n\r\n    }\r\n\r\n    then(onFulfilled, onRejected) {\r\n\r\n        // initialize array\r\n        this.cache = this.cache || [];\r\n\r\n        var promise = new Promise();\r\n        var that = this;\r\n        this.async(function () {\r\n            that.cache.push({\r\n                fulfill: onFulfilled,\r\n                reject: onRejected,\r\n                promise: promise\r\n            });\r\n            that.resolve();\r\n        });\r\n\r\n        return promise;\r\n    }\r\n\r\n\r\n    resolve() {\r\n        // check if pending\r\n        if (this.state == this.State.PENDING) {\r\n            return false;\r\n        }\r\n\r\n        // for each 'then'\r\n        while (this.cache && this.cache.length) {\r\n            var obj = this.cache.shift();\r\n\r\n            // get the function based on state\r\n            var fn = this.state == this.State.FULFILLED ? obj.fulfill : obj.reject;\r\n            if (typeof fn != 'function') {\r\n                obj.promise.changeState(this.state, this.value);\r\n            } else {\r\n\r\n                // fulfill promise with value or reject with error\r\n                try {\r\n\r\n                    var value = fn(this.value);\r\n\r\n                    // deal with promise returned\r\n                    if (value && typeof value.then == 'function') {\r\n\r\n                        value.then(function (value) {\r\n                            obj.promise.changeState(this.State.FULFILLED, value);\r\n                        }, function (reason) {\r\n                            obj.promise.changeState(this.State.REJECTED, error);\r\n                        });\r\n                        // deal with other value returned\r\n                    } else {\r\n                        obj.promise.changeState(this.State.FULFILLED, value);\r\n                    }\r\n                    // deal with error thrown\r\n                } catch (error) {\r\n                    obj.promise.changeState(this.State.REJECTED, error);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    async(fn) {\r\n        setTimeout(fn, 0);\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}